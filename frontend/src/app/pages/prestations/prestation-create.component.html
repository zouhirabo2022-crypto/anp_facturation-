<div class="container-fluid mt-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow-sm border-0">
                <div class="card-header bg-white py-3 border-0">
                    <div class="d-flex justify-content-between align-items-center">
                        <h4 class="mb-0 text-primary">
                            <i class="fas" [ngClass]="isEditMode ? 'fa-edit' : 'fa-plus-circle'"></i>
                            {{ isEditMode ? 'Modifier la Prestation' : 'Nouvelle Prestation' }}
                        </h4>
                        <button class="btn btn-outline-secondary btn-sm" (click)="cancel()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                
                <div class="card-body">
                    <div *ngIf="errorMessage" class="alert alert-danger mb-4">
                        <i class="fas fa-exclamation-circle me-2"></i>{{ errorMessage }}
                    </div>

                    <form (ngSubmit)="savePrestation()" #prestationForm="ngForm">
                        <div class="row g-3">
                            <!-- Informations Principales -->
                            <div class="col-12">
                                <h6 class="text-muted border-bottom pb-2 mb-3">Informations Principales</h6>
                            </div>
                            
                            <div class="col-md-6">
                                <label class="form-label required">Code Prestation</label>
                                <input type="text" class="form-control" [(ngModel)]="prestation.code" name="code" required 
                                       [class.is-invalid]="prestationForm.submitted && !prestation.code" placeholder="Ex: EAU_BASE">
                                <div class="invalid-feedback">Le code est requis.</div>
                            </div>
                            
                            <div class="col-md-6">
                                <label class="form-label required">Libellé</label>
                                <input type="text" class="form-control" [(ngModel)]="prestation.libelle" name="libelle" required 
                                       [class.is-invalid]="prestationForm.submitted && !prestation.libelle" placeholder="Description de la prestation">
                                <div class="invalid-feedback">Le libellé est requis.</div>
                            </div>

                            <!-- Paramètres de Facturation -->
                            <div class="col-12 mt-4">
                                <h6 class="text-muted border-bottom pb-2 mb-3">Paramètres de Facturation</h6>
                            </div>

                            <div class="col-md-4">
                                <label class="form-label">Unité</label>
                                <div class="input-group">
                                    <span class="input-group-text bg-light"><i class="fas fa-ruler-combined text-muted"></i></span>
                                    <input type="text" class="form-control" [(ngModel)]="prestation.unite" name="unite" placeholder="Ex: m3, kWh, Jour">
                                </div>
                            </div>

                            <div class="col-md-4">
                                <label class="form-label">Taux TVA (%)</label>
                                <div class="input-group">
                                    <span class="input-group-text bg-light">%</span>
                                    <input type="number" class="form-control" [(ngModel)]="prestation.tauxTva" name="tauxTva" placeholder="20">
                                </div>
                            </div>

                            <div class="col-md-4">
                                <label class="form-label">Taux TR (%)</label>
                                <div class="input-group">
                                    <span class="input-group-text bg-light">%</span>
                                    <input type="number" class="form-control" [(ngModel)]="prestation.tauxTr" name="tauxTr" placeholder="0">
                                </div>
                            </div>

                            <div class="col-12">
                                <label class="form-label">Compte Comptable</label>
                                <input type="text" class="form-control" [(ngModel)]="prestation.compteComptable" name="compteComptable" placeholder="Ex: 706100">
                            </div>

                            <div class="col-12 mt-3" *ngIf="!isEditMode">
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    Les tarifs spécifiques (Tranches ou OTDP) pourront être configurés après la création de la prestation.
                                </div>
                            </div>
                        </div>

                        <div class="d-flex justify-content-end gap-2 mt-5">
                            <button type="button" class="btn btn-light border" (click)="cancel()">
                                Annuler
                            </button>
                            <button type="submit" class="btn btn-primary" [disabled]="loading">
                                <span *ngIf="loading" class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                                <i class="fas fa-save me-2" *ngIf="!loading"></i>
                                {{ isEditMode ? 'Mettre à jour' : 'Enregistrer' }}
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
